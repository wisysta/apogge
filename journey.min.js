document.addEventListener("DOMContentLoaded",function(){"scrollRestoration"in history&&(history.scrollRestoration="manual");const e=document.querySelectorAll(".journey-step"),t=document.querySelectorAll(".journey-detail-section");let n=!1;function s(e){n||(t.forEach(e=>{e.classList.remove("expanded"),e.classList.add("collapsed")}),n=!0,function(e){const t=window.innerWidth<=768,n=document.querySelector(".journey-hero")?.offsetHeight||window.innerHeight,s=parseInt(e.replace("step",""))-1;let o;t?(o=n+s*(.3*window.innerHeight),o=Math.max(0,o-10)):o=n+s*(.5*window.innerHeight),window.scrollTo({top:o,behavior:"smooth"})}(e),setTimeout(()=>{const t=document.getElementById(e);t&&(t.classList.remove("collapsed"),t.classList.add("expanded")),setTimeout(()=>{n=!1},400)},300))}e.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-target");e&&s(e)})}),t.forEach(e=>{e.addEventListener("click",function(e){if(this.classList.contains("expanded"))return;const t=this.getAttribute("id");t&&s(t)})}),document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.querySelector(".journey-detail-section.expanded");e&&((t=e).classList.remove("expanded"),t.classList.add("collapsed"))}var t});const o=document.querySelector(".header");let c=window.scrollY;window.addEventListener("scroll",()=>{const e=window.scrollY;o&&(o.style.transform=e>c&&e>100?"translateY(-100%)":"translateY(0)"),c=e}),t.forEach(e=>{const t=e.getAttribute("data-image"),n=e.querySelector(".section-background");n&&t&&(n.style.backgroundImage=`url('${t}')`)}),window.addEventListener("resize",function(){window.innerWidth<768&&t.forEach(e=>{e.classList.remove("expanded"),e.classList.add("collapsed")})}),a();const i=document.querySelector(".journey-hero");function a(){const e=document.getElementById("map-container");if(!e)return;const t=window.innerWidth<=768;fetch(t?"./images/map-mo.svg":"https://ecimg.cafe24img.com/pg2069b88099925051/cerezia/images/map-pc.svg").then(e=>e.text()).then(t=>{e.innerHTML=t,function(){const e=document.querySelector("#map-container svg");if(!e)return void console.error("SVG 요소를 찾을 수 없습니다");console.log("SVG 로딩 성공, 내용 길이:",e.outerHTML.length);const t=e.querySelector("#canada-circle"),n=e.querySelector("#canada-marker"),s=e.querySelector("#canada-dottted-line"),o=e.querySelector("#canada-text"),c=e.querySelector("#newzealand-circle"),i=e.querySelector("#newzealand-marker"),a=e.querySelector("#newzealand-dottted-line"),r=e.querySelector("#newzealand-text"),l=document.getElementById("newzealand-detail"),d=document.getElementById("canada-detail");let u={state:"idle",timers:[],touchActive:!1},m={state:"idle",timers:[],touchActive:!1},v=null;function h(){if("showing"!==u.state&&"shown"!==u.state&&(g(),u.state="showing",function(){s&&(s.style.opacity="1");const e=setTimeout(()=>{o&&(o.style.opacity="1",o.style.transform="translateY(0)");const e=setTimeout(()=>{u.state="shown"},500);u.timers.push(e)},200);u.timers.push(e)}(),d)){const e=setTimeout(()=>{v&&v!==d&&v.classList.remove("active"),d.classList.add("active"),v=d},500);u.timers.push(e)}}function y(){if(!u.touchActive){if("showing"===u.state){const e=setTimeout(()=>{f(),p()},500);return void u.timers.push(e)}"hiding"!==u.state&&(f(),p())}}function p(){d&&v===d&&!u.touchActive&&(d.classList.remove("active"),v=null)}function f(){g(),u.state="hiding",o&&(o.style.opacity="0",o.style.transform="translateY(15px)");const e=setTimeout(()=>{s&&(s.style.opacity="0");const e=setTimeout(()=>{u.state="idle"},600);u.timers.push(e)},100);u.timers.push(e)}function g(){u.timers.forEach(e=>clearTimeout(e)),u.timers=[]}function w(){if("showing"!==m.state&&"shown"!==m.state&&(T(),m.state="showing",function(){a&&(a.style.opacity="1");const e=setTimeout(()=>{r&&(r.style.opacity="1",r.style.transform="translateY(0)");const e=setTimeout(()=>{m.state="shown"},500);m.timers.push(e)},200);m.timers.push(e)}(),l)){const e=setTimeout(()=>{v&&v!==l&&v.classList.remove("active"),l.classList.add("active"),v=l},500);m.timers.push(e)}}function L(){if(!m.touchActive){if("showing"===m.state){const e=setTimeout(()=>{A(),E()},500);return void m.timers.push(e)}"hiding"!==m.state&&(A(),E())}}function E(){l&&v===l&&!m.touchActive&&(l.classList.remove("active"),v=null)}function A(){T(),m.state="hiding",r&&(r.style.opacity="0",r.style.transform="translateY(15px)");const e=setTimeout(()=>{a&&(a.style.opacity="0");const e=setTimeout(()=>{m.state="idle"},600);m.timers.push(e)},100);m.timers.push(e)}function T(){m.timers.forEach(e=>clearTimeout(e)),m.timers=[]}function k(){u.touchActive?(u.touchActive=!1,f(),p()):(m.touchActive=!1,A(),E(),u.touchActive=!0,h())}function S(){m.touchActive?(m.touchActive=!1,A(),E()):(u.touchActive=!1,f(),p(),m.touchActive=!0,w())}s&&(s.style.opacity="0",s.style.transition="opacity 0.6s ease"),o&&(o.style.opacity="0",o.style.transform="translateY(15px)",o.style.transition="opacity 0.5s ease, transform 0.5s ease"),a&&(a.style.opacity="0",a.style.transition="opacity 0.6s ease"),r&&(r.style.opacity="0",r.style.transform="translateY(15px)",r.style.transition="opacity 0.5s ease, transform 0.5s ease"),t?(t.addEventListener("mouseenter",h),t.addEventListener("mouseleave",y),t.addEventListener("click",k),t.addEventListener("touchend",function(e){e.preventDefault(),k()}),t.style.cursor="pointer",console.log("캐나다 원 이벤트 등록 완료")):console.warn("캐나다 원 요소를 찾을 수 없습니다: #canada-circle"),n?(n.addEventListener("mouseenter",h),n.addEventListener("mouseleave",y),n.addEventListener("click",k),n.addEventListener("touchend",function(e){e.preventDefault(),k()}),n.style.cursor="pointer",console.log("캐나다 마커 이벤트 등록 완료")):console.warn("캐나다 마커 요소를 찾을 수 없습니다: #canada-marker"),c?(c.addEventListener("mouseenter",w),c.addEventListener("mouseleave",L),c.addEventListener("click",S),c.addEventListener("touchend",function(e){e.preventDefault(),S()}),c.style.cursor="pointer",console.log("뉴질랜드 원 이벤트 등록 완료")):console.warn("뉴질랜드 원 요소를 찾을 수 없습니다: #newzealand-circle"),i?(i.addEventListener("mouseenter",w),i.addEventListener("mouseleave",L),i.addEventListener("click",S),i.addEventListener("touchend",function(e){e.preventDefault(),S()}),i.style.cursor="pointer",console.log("뉴질랜드 마커 이벤트 등록 완료")):console.warn("뉴질랜드 마커 요소를 찾을 수 없습니다: #newzealand-marker");const q=document.querySelector(".origin-section");let x;q&&q.addEventListener("click",e=>{e.target.closest(".region-detail")||e.target.closest("#canada-circle")||e.target.closest("#canada-marker")||e.target.closest("#newzealand-circle")||e.target.closest("#newzealand-marker")||(v&&(v.classList.remove("active"),v=null),u.touchActive=!1,m.touchActive=!1,f(),A())}),document.addEventListener("click",function(e){const t=document.getElementById("map-container");t&&!t.contains(e.target)&&(u.touchActive=!1,m.touchActive=!1,f(),A(),v&&(v.classList.remove("active"),v=null))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(u.touchActive=!1,m.touchActive=!1,f(),A(),v&&(v.classList.remove("active"),v=null))}),window.addEventListener("scroll",()=>{clearTimeout(x),x=setTimeout(()=>{v&&(v.classList.remove("active"),v=null,u.touchActive=!1,m.touchActive=!1,f(),A())},100)})}()}).catch(e=>{console.error("SVG 로드 실패:",e)})}i&&setTimeout(()=>{i.classList.add("loaded")},300),console.log("Journey 페이지 스크립트 로드 완료"),window.addEventListener("resize",()=>{const e=document.getElementById("map-container");e&&e.innerHTML&&a()})});